# =============================================================
# Exoscale Deploy Kit — Configuration
# Run: python3 wizard.py   to set all values interactively
# Run: python3 deploy_pipeline.py --auto   to deploy directly
# Credentials go in .env (NEVER commit .env to git)
# =============================================================

# ── Project Identity ──────────────────────────────────────────
project_name: exoscale-kit-test      # prefix for ALL cloud resources
service_name: deploy-kit-svc         # Docker image name + K8s Deployment name
service_version: "1.0.0"             # pushed as :version and :latest
docker_hub_user: iandrewitz

# ── Environment Profile ───────────────────────────────────────
# dev | staging | production  (wizard uses this to set sensible defaults)
environment: production

# ── Exoscale Cloud ────────────────────────────────────────────
# Available zones: ch-gva-2, ch-dk-2, at-vie-1, de-fra-1, bg-sof-1
exoscale_zone: ch-gva-2

# SKS Cluster
sks_level: pro              # starter | pro
sks_cni: calico             # calico | cilium
sks_addons:
  - exoscale-cloud-controller   # Required for NLB auto-provisioning
  - metrics-server              # Required for HPA

# ── Compute — Worker Nodes ────────────────────────────────────
# node_type_family: standard | memory | cpu | storage | gpu
# node_type_size:   tiny | small | medium | large | extra-large | huge
node_type_family: standard
node_type_size: medium
node_count: 2         # min 2 for HA in production
node_disk_gb: 50      # GB per node

# ── Kubernetes ────────────────────────────────────────────────
k8s_namespace: exoscale-kit-production
k8s_replicas: 2
k8s_port: 5000        # container port (inside the container)
k8s_service_port: 5000
# Pre-approved NodePorts in Exoscale default SG: 30671, 30888, 30999
k8s_nodeport: 30671

# ── Load Balancer ─────────────────────────────────────────────
# enabled: true = NLB auto-provisioned via K8s type:LoadBalancer (~EUR 8/mo)
# LESSON: Do NOT create NLB manually — the cloud controller does it automatically
load_balancer:
  enabled: true
  type: nlb

# ── Ingress / Web Server ──────────────────────────────────────
# enabled: true = deploy an Ingress controller (nginx or traefik)
# Required for: custom domains, TLS/HTTPS, path-based routing, multiple services
ingress:
  enabled: false
  provider: nginx       # nginx | traefik
  tls: false
  domain: ""            # e.g. myapp.example.com (required if tls: true)
  cert_email: ""        # Let's Encrypt email (required if tls: true)

# ── Database ──────────────────────────────────────────────────
# enabled: true = include a database in the deployment
# type:       postgres | mysql | redis
# deployment: managed (Exoscale DBaaS) | self-hosted (K8s StatefulSet)
database:
  enabled: false
  type: postgres
  deployment: managed   # managed (DBaaS) | self-hosted (K8s StatefulSet)
  version: "16"
  storage_gb: 20        # only used for self-hosted
  replicas: 1           # only used for self-hosted (1=single, 3=HA)

# ── Autoscaling (HPA) ─────────────────────────────────────────
# Requires metrics-server addon (included in sks_addons above)
autoscaling:
  enabled: true
  min_replicas: 2
  max_replicas: 10
  cpu_target_percent: 70      # scale out when CPU > this %
  memory_target_percent: 80   # scale out when memory > this %

# ── Container Resource Limits ─────────────────────────────────
resources:
  requests:
    cpu: "200m"         # guaranteed CPU (1000m = 1 core)
    memory: "256Mi"     # guaranteed memory
  limits:
    cpu: "1000m"        # hard CPU cap
    memory: "1Gi"       # hard memory cap

# ── Resilience ────────────────────────────────────────────────
pod_disruption_budget:
  enabled: true         # recommended for production
  min_available: 1      # always keep at least 1 pod running during maintenance

# ── Monitoring ────────────────────────────────────────────────
monitoring:
  metrics_server: true  # required for HPA — included via sks_addons
