# =============================================================
# Exoscale Deploy Kit - Configuration
# Updated: 2026-02-23 — Full Infrastructure Test Suite
# =============================================================
# Edit values below OR re-run: python3 wizard.py
# Credentials go in .env (NEVER commit .env to git)
#
# NAMING CONVENTION:
#   project_name format:  stargate-YYYYMMDD
#   Example next deploy:  stargate-20260223
#   The date suffix makes every deployment uniquely identifiable
#   and enables easy resource discovery / teardown by date.
#
# Deploy:   python3 deploy_pipeline.py --auto
# Teardown: python3 teardown.py --force
# =============================================================

# --- Project Identity ---
project_name: stargate-20260223       # stargate-YYYYMMDD  ← change date each deploy
service_name: stargate
service_version: '1'
docker_hub_user: iandrewitz
environment: production

# --- Exoscale Zone ---
exoscale_zone: ch-dk-2                # Zurich (change to ch-gva-2 for Geneva)

# --- SKS Kubernetes Cluster ---
sks_level: starter
sks_cni: calico
sks_addons:
  - exoscale-cloud-controller
  - metrics-server

# --- Worker Nodes ---
node_type_family: standard
node_type_size: small                 # small=2vCPU/2GB | medium=2vCPU/4GB | large=4vCPU/8GB
node_count: 2
node_disk_gb: 50

# --- Node Labels (StarGate branding on K8s worker nodes) ---
# Adds kubectl labels to all worker nodes after they are Ready.
# Labels appear in: kubectl get nodes --show-labels
node_labels:
  enabled: true
  labels:
    stargate.io/project: stargate-20260223
    stargate.io/role: worker
    stargate.io/zone: ch-dk-2
    app.kubernetes.io/managed-by: exoscale-deploy-kit

# --- Kubernetes Namespace & Service ---
k8s_namespace: exo-stargate-prod
k8s_replicas: 1
k8s_port: 5000
k8s_service_port: 5000
k8s_nodeport: 30671

# --- Load Balancer & Ingress ---
load_balancer:
  enabled: true
  type: nlb
ingress:
  enabled: true
  provider: nginx
  tls: true
  domain: synergy-group.ch
  cert_email: andrewitz@gmail.com

# --- Object Storage (SOS — Exoscale S3-compatible Simple Object Storage) ---
# Creates an SOS bucket and injects credentials as K8s secret 'sos-credentials'.
# Access via: AWS_S3_ENDPOINT, SOS_BUCKET, SOS_ACCESS_KEY, SOS_SECRET_KEY
# Use cases: file uploads, static assets, agent artefacts, backups, logs
object_storage:
  enabled: true
  bucket_name: assets                 # full name = {project_slug}-assets
  acl: private                        # private | public-read

# --- Block Storage (Exoscale BSS via Exoscale CSI Driver) ---
# Provisions a PersistentVolumeClaim backed by Exoscale Block Storage SSD.
# Installs the Exoscale CSI driver into the cluster (first-time only).
# Use cases: persistent agent state, database volumes, model weights
block_storage:
  enabled: true
  storage_class: exoscale-ssd
  size_gb: 10
  access_mode: ReadWriteOnce          # ReadWriteOnce = single-node mount (BSS limitation)
  mount_path: /data                   # where PVC mounts inside the container

# --- Database (Exoscale DBaaS — fully managed) ---
# Provisions a managed database service (PostgreSQL by default).
# Connection string injected as K8s secret 'db-credentials'.
# Use cases: agent state, knowledge graphs, event store, metrics
database:
  enabled: true
  type: pg                            # pg | mysql | redis | opensearch | kafka
  version: '16'                       # pg: 13/14/15/16 | mysql: 8
  plan: startup-4                     # Exoscale plan — startup-4 is smallest (testing)
  termination_protection: false       # false = easy teardown for testing/dev

# --- Autoscaling ---
autoscaling:
  enabled: true
  min_replicas: 2
  max_replicas: 10
  cpu_target_percent: 70
  memory_target_percent: 80

# --- Resource Quotas ---
resources:
  requests:
    cpu: '200'
    memory: '256'
  limits:
    cpu: '1000'
    memory: 1Gi

# --- Monitoring ---
monitoring:
  metrics_server: true

# --- Availability ---
pod_disruption_budget:
  enabled: true
  min_available: 1
